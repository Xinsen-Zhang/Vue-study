<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <title>使用函数化组件进行智能选择</title>
</head>
<body>
    <div id="app">
        <smart-item :data="data"></smart-item>
        <button @click="changeItem('image')">切换为图片组件</button>
        <button @click="changeItem('video')">切换为视频组件</button>
        <button @click="changeItem('text')">切换为纯文本组件</button>
    </div>
    <script>
        // 图片组件
        var imageItem = {
            props: ['data'],
            render: function(createElement) {
                return createElement('div', [
                    createElement('p', '图片组件'),
                    createElement('img', {
                        attrs: {
                            src: this.data.url
                        }
                    })
                ])
            },
        }
        // 视频组件
        var videoItem = {
            props: ['data'],
            render: function (createElement) {
                'div', [
                    createElement('p', '视频组件'),
                    createElement('video', {
                        attrs: {
                            src: this.data.url,
                            controls: 'controls',
                            autoplay: 'autoplay'
                        }
                    })
                ]
            }
        }
        // 纯文本组件
        var textItem = {
            props: ['data'],
            render: function (createElement) {
                'div',
                [
                    createElement('p', '纯文本组件'),
                    createElement('p', this.data.text)
                ]
            }
        }
        //   函数化组件
        Vue.component('smart-item', {
            functional: true,
            render: function (createElement, context) {
                /*
                函数化组件
                param createElement(function): 创建 元素 的函数
                param context(object): 临时的上下文对象
                return (VNode): 返回虚拟节点
                */
                // 根据传入的数据, 智能判断组件
                function getComponent() {
                    var data = context.props.data
                    // 判断 props 中,data.type 的类型
                    if (data.type === 'image') return imageItem;
                    if (data.type === 'video') return videoItem;
                    return textItem;
                }
                // 返回 Vnode
                return createElement(getComponent(), {
                    props: {
                        // 把 smart-item:data 传给组件
                        data: context.props.data
                    }
                },
                context.children) // 当前上下文中所有的子节点 Vnode []
            },
            props: {
                data: {
                    type: Object,
                    required: true
                }
            }
        })

        // 实例化组件
        const app = new Vue({
            el: '#app',
            data: {
                data: {}
            },
            methods: {
                changeItem: function (type) {
                    if (type === 'image') {
                        this.data = {
                            type: 'image',
                            url: 'https://stack-1252734833.cos.ap-beijing.myqcloud.com/ins/cat/hottest/image/2019-03-12/Bu1YRpbh6lH.png?q-sign-algorithm=sha1&q-ak=AKID4s13y1C1QVgnfbiPpo34XISC8Pos3CSU&q-sign-time=1552959673;1552961473&q-key-time=1552959673;1552961473&q-header-list=&q-url-param-list=&q-signature=b05187bd50932a52c281eb82aaa306dda0581231&x-cos-security-token=29b4db1d76abacb74e96169b48408a1f62574d9e10001'
                        }
                    }
                    else if (type === 'text') {
                        this.data = {
                            type: 'text',
                            text: '这是一段纯文本'
                        }
                    }
                    else if(type === 'video') {
                        this.data = {
                            type: 'video',
                            url: 'http://vjs.zencdn.net/v/oceans.mp4'
                        }
                    }
                }
            },
            mounted: function () {
                this.changeItem('text')
            }
        })
    </script>
</body>
</html>